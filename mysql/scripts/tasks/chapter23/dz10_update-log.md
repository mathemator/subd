# Лог изменений базы данных 

## Внесённые изменения

1. **Таблица `purchase` - расширение идентификатора:**
    - Для получениявозможности редактирования связанных столбцов временно удалён внешний ключ `fk_purchase_customer`.
    - Изменён тип данных столбца `id` на `BIGINT`.
    - Изменён тип данных столбца `customer_id` на `BIGINT` для соответствия связанному.
    - Обратно внедрён внешний ключ `fk_purchase_customer`, ссылающийся на обновленный `customer(id)`.
    - Добавлен столбец `metadata` типа `JSON` с дефолтным значением `NULL`.

2. **Таблица `customer`:**
    - Изменён тип данных столбца `id` на `BIGINT `.

3. **Таблица `product`:**
    - Расширен столбец `price` на `DECIMAL(12, 2) NOT NULL` для дорогих покупок.
    - Добавлен столбец `attributes` типа `JSON` с дефолтным значением `NULL` для произвольных атрибутов товара.

## Пример запроса на выборку с использованием JSON

```sql
-- Выборка продуктов, у которых в JSON-атрибуте указан цвет "красный"
SELECT *
FROM product
WHERE JSON_EXTRACT(attributes, '$.color') = 'red';
```
### Результат:
| **id** | **name** | **price** | **manufacturer_id** | **supplier_id** | **attributes**                                      |
|--------|----------|-----------|---------------------|-----------------|-----------------------------------------------------|
| 5      | T-shirt  | 19.99     | 1                   | 1               | {"size": "M", "color": "red", "material": "cotton"} |

## Другой пример, поиск по атрибуту
```sql
-- Выборка уникальных цветов для товаров с именем "T-shirt"
SELECT DISTINCT JSON_UNQUOTE(attributes->'$.color') AS color
FROM product
WHERE name = 'T-shirt'
AND attributes->>'$.color' IS NOT NULL;
```
### Результат:
| **color** |
|-----------|
| red       |
😺


